# リリースノート

## v1.0

**アメモバ Google口コミモニター（AmeReMo）** の初回リリースです。

---

### 概要

アメモバ（AMEMOBA）とサクモバ（SAKUMOBA）の各店舗のGoogle口コミを定常的にモニターし、評判推移（件数・平均評価）と投稿内容を社内で一括確認できるWebアプリです。Vercel + PostgreSQL でデプロイ可能で、1日1回の口コミ自動取得に対応しています。

---

### v1.0 仕様

#### 対象・目的

| 項目 | 内容 |
|------|------|
| 対象ブランド | アメモバ（AMEMOBA）・サクモバ（SAKUMOBA）の全店舗 |
| 目的 | 店舗ごとのGoogle口コミ件数・平均評価の推移把握と、個別口コミの内容確認 |
| 利用想定 | 社内での定期確認・共有。URLクエリで店舗・ブランド・期間を指定したリンク共有が可能（スラッグ対応） |
| アクセス制御 | 簡易パスワード認証（Cookie）で未登録ユーザーをブロック |

#### サイト構造

- **メインページ（`/`）**: 「ダッシュボード」と「口コミ一覧」の2タブを切り替え
- **ログイン（`/login`）**: パスワード入力で認証後、メインへリダイレクト

#### 認証

- パスワードによるログイン（環境変数 `SITE_PASSWORD`）
- ログイン状態はCookieで保持。未ログイン時は `/login` へリダイレクト

#### ダッシュボード

- **サマリ**: 選択条件での口コミ総数・平均評価
- **時系列グラフ**: 日別 / 週別 / 月別の集計粒度切り替え、口コミ件数（棒）と平均評価（折れ線）
- **評価別テーブル**: 店舗ごとの評価分布（1〜5の件数）。セルは表全体の最大値に対するグラデーション表示。0は白。店舗名はブランド色（緑/オレンジ）・太字
- **期間別テーブル**: 店舗×期間の件数マトリクス。同様に表全体でグラデーション・0は白・店舗名はブランド色・太字
- **フィルター**: ブランド（全店舗 / アメモバのみ / サクモバのみ）、店舗（単一または複数選択）、期間（開始日・終了日）

#### 口コミ一覧

- **一覧**: 店舗名・評価・本文・投稿者・投稿日。50件/ページでページング
- **ソート**: 新しい順 / 古い順 / 評価高い順 / 評価低い順
- **フィルター**: ブランド・店舗・期間（ダッシュボードと共通）
- **店舗×評価セルクリック**: 評価別テーブルでセルをクリックすると、その店舗・その評価の口コミをポップアップ表示
- **Googleマップ連携**: 各口コミや店舗から、Googleマップの口コミタブを開くリンク（Places API の `reviewsUri` / 口コミ単体URLを利用）

#### データ取得

- **手動再取得**: UIの「口コミデータを再取得」ボタン、または `POST /api/fetch-reviews`
- **自動取得**: Vercel Cron で **1日1回（0:00 UTC = 日本時間 9:00）** に口コミを自動取得（`GET /api/cron/fetch-reviews`）。`CRON_SECRET` で保護可能
- **取得元**: Google Places API（Places API (New)）。店舗が0件の場合は初期店舗を自動作成してから取得
- **蓄積**: 同一口コミは `sourceReviewId` で重複排除。新規分のみDBに追加され、少しずつ蓄積

#### ナビゲーション・UI

- 店舗ボタンは **ブランド順（アメモバ→サクモバ）・地域順**（上野→秋葉原→新宿→柏→大宮→名古屋）で表示
- ブランドフィルター（すべて / Am / Sk）、期間・集計粒度・ソートの切り替え、口コミ再取得ボタンを共通ナビで提供

---

### 達成したこと（v1.0 で実装した機能）

- [x] パスワード認証とログインページ
- [x] ダッシュボード：サマリ・時系列グラフ（日/週/月別）・評価別テーブル・期間別テーブル
- [x] 口コミ一覧：一覧・ページング・ソート・フィルター・店舗×評価ポップアップ
- [x] Google Places API による口コミ取得とDB蓄積（重複排除）
- [x] 手動での口コミ再取得（UI・API）
- [x] **1日1回の自動取得（Vercel Cron）**
- [x] 店舗のGoogle口コミタブURL・口コミ単体URLの取得とリンク
- [x] ブランド・店舗・期間によるフィルター（URLスラッグ対応で共有可能）
- [x] 評価別・期間別テーブルの件数セルを **表全体の最大値** でグラデーション表示（0は白）
- [x] 店舗名のブランド色（緑=アメモバ、オレンジ=サクモバ）と太字表示
- [x] ナビゲーションの店舗ボタンをブランド順・地域順で表示
- [x] 店舗名の変更（上野店・秋葉原店など）をコード・ドキュメント全体で統一
- [x] Vercel デプロイ対応（Postgres・環境変数・Cron・README手順）

---

### 技術スタック（v1.0）

| 項目 | 技術 |
|------|------|
| フロントエンド | Next.js 16, React, TypeScript, Tailwind CSS |
| バックエンド | Next.js API Routes |
| データベース | PostgreSQL + Prisma ORM（本番は Vercel Postgres 推奨） |
| 外部API | Google Places API（Places API (New)） |

---

### 今後の拡張（README より）

- 低評価アラート（Slack/メール通知）
- ネガ/ポジ分類、頻出ワード抽出（LLM要約）
- 返信（オーナー返信）管理・テンプレート化
- 店舗管理ページ
- ユーザー認証（Googleログイン等）
- レポート出力機能（PDF/Excel）

---

### 関連ドキュメント

- [README.md](../README.md) - セットアップ・使い方・API・DBスキーマ
- [specs.md](../specs.md) - 仕様書
- [shoplist.md](../shoplist.md) - 店舗一覧・Place ID
- [docs/gbp-api-setup-guide.md](gbp-api-setup-guide.md) - Google Business Profile API 設定ガイド
